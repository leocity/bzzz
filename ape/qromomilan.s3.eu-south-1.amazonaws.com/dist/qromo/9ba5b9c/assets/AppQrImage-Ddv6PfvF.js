import{A as h}from"./AppInPlaceCloud-Dg08S17k.js";import{A as f}from"./AppButton-CMSLQd3U.js";import{_ as w,u as m,D as p,r as i,o as a,c as g,a as l,l as C,v as Q,i as D,j as L,b as k,e as v,m as _,n as y}from"./index-BX7k1nCh.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a6eea860-fa69-47a8-8883-899a8d63b593",e._sentryDebugIdIdentifier="sentry-dbid-a6eea860-fa69-47a8-8883-899a8d63b593")}catch{}})();const I={setup(){let e=m(),t=p();return{getString:e.getString,loadScript:t.loadScript}},name:"AppQrImage",components:{AppButton:f,AppInPlaceCloud:h},props:{value:{type:String,default:""},name:{type:String,default:"download"},size:{type:Number,default:170},withDownloadButton:{type:Boolean,default:!1}},data(){return{currQr:null,downloadLink:null,qrLoadTimeout:null,loadedQrLibrary:!1,closeDownloadCloudListener:null,activeDownloadQrCloud:!1}},computed:{sizeStyle(){return"--qr-size: "+this.size+"px"}},methods:{setQrImage(){let e=()=>{this.currQr&&this.currQr.clear(),this.$refs["qr-container"]&&(this.$refs["qr-container"].innerHTML="",this.currQr=new QRCode(this.$refs["qr-container"],{text:this.value,width:this.size-50,height:this.size-50,onRenderingEnd:this.setDownloadLink}))};this.loadedQrLibrary?e():(clearTimeout(this.qrLoadTimeout),this.qrLoadTimeout=setTimeout(()=>{this.setQrImage()},100))},clickQr(){this.closeDownloadCloudListener||(this.activeDownloadQrCloud=!0,this.closeDownloadCloudListener=e=>{e.target&&!e.target.classList.contains("download-qr-container")&&!this.elementIsInQr(e.target)?(this.closeDownloadCloudListener=null,this.activeDownloadQrCloud&&(this.activeDownloadQrCloud=!1)):document.addEventListener("click",this.closeDownloadCloudListener,{once:!0})},document.addEventListener("click",this.closeDownloadCloudListener,{once:!0}))},closeCloud(){this.activeDownloadQrCloud=!1,document.removeEventListener("click",this.closeDownloadCloudListener)},elementIsInQr(e){let t=20,o=0;for(;e.parentElement&&o<=t;){if(e.classList.contains("download-qr-container"))return!0;e=e.parentElement,o++}return!1},setDownloadLink(){let e=this.$refs&&this.$refs["qr-container"]&&this.$refs["qr-container"].children;e&&e.length===2&&(this.downloadLink=e[1].getAttribute("src"))},clickDownloadQr(){this.downloadLink&&this.$refs["download-link"].click()}},mounted(){this.loadScript("qrs",()=>{this.loadedQrLibrary=!0,this.setQrImage()})},watch:{value(){this.setQrImage()},size(){this.setQrImage()}}},b={ref:"qr-container",class:"qr-container"},q=["download","href"];function S(e,t,o,s,r,n){const d=i("AppButton"),c=i("AppInPlaceCloud");return a(),g("div",{onClick:t[0]||(t[0]=(...u)=>n.clickQr&&n.clickQr(...u)),style:_(n.sizeStyle),class:y(["download-qr-container",{pointer:o.withDownloadButton}])},[l("div",b,null,512),o.withDownloadButton?C((a(),D(c,{key:0,onCloseCloud:n.closeCloud,top:"",active:r.activeDownloadQrCloud},{default:L(()=>[k(d,{onClick:n.clickDownloadQr,"icon-left":"icon-download-secondary",text:s.getString("download_qr")},null,8,["onClick","text"]),l("a",{ref:"download-link",download:"qrcode-"+o.name+".png",href:r.downloadLink,class:"invisible"},null,8,q)]),_:1},8,["onCloseCloud","active"])),[[Q,r.currQr]]):v("",!0)],6)}const x=w(I,[["render",S],["__scopeId","data-v-71cbbc9c"]]);export{x as A};
//# sourceMappingURL=AppQrImage-Ddv6PfvF.js.map
